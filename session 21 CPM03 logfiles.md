---
aliases: 
tags: 
date created: Friday, September 22nd 2023, 4:54:43 pm
date modified: Friday, October 6th 2023, 1:48:06 am
---

## Location of the Log Files

**The Location of the Log Files**: `C:\Program Files(x86)\CyberArk\PasswordManager\Logs`

## List of Log Files Related to CPM

| File          | Description                                                                                                                                                                                                                                                                             |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| pm.log        | This file contains all the log messages, including general and informative messages, errors, and warnings.                                                                                                                                                                              |
| pm_error.log  | This file contains only warning and error messages.                                                                                                                                                                                                                                     |
| PMConsole.log | This file contains informational messages about the CPM, such as ‘Server is starting’ and ‘Server is shutting down’. This log is meant for system administrators who monitor the status of the CPM. Errors that refer to CPM function and user authentication are included in this log. |
| PMTrace.log   | This file contains errors and trace messages. The types of messages that are included in this log depend on the debug levels.                                                                                                                                                           |
| CACPMScanner.log | Account discovery related information is logged here |

### CASOS

- CASOS is an acronym for: **CyberArk Secure Operating System**.
- When changing the DebugLevel/InformationLevel in the PVWA the casos configuration is refreshed.  
- The higher the level set the more log entries are written to the log files

| Log File             | Description                                                                                                                                               |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Casos.Activity.log` | Logs the CPM-related activity. Transactions between the vault and the CPM are recorded here.                                                               |
| `Casos.Debug.log`    | Provides detailed information about the system's operations, often used for troubleshooting or identifying the steps leading up to an issue.               |
| `Casos.Error.log`    | Specifically logs error messages. This file captures any issues or failures within the system, making it a go-to when diagnosing problems or malfunctions. |

### Debug Level

|Debug level|Indicates|
|---|---|
|0|No messages are written to the trace log.|
|1|CPM exceptions are written to the trace log. This is the default debug level.|
|2|CPM trace messages are written to the trace log.|
|3|CPM CASOS activities are written to the trace log.|
|4|CPM CASOS debug activities are written to the trace log.|
|5|CPM CASOS errors are written to the trace log.|
|6|All CPM CASOS activities and errors are written to the trace log.|

### Archive Folder

- Folder that contains the older archived log files 
- Each time a log file is uploaded to the Vault, it is copied to the Log/Old folder, and the CPM begins writing to a new log file.

### Third Party Logs

- Errors that occur during the password change process on the remote machine are saved in a log file and stored in the Log folder. This file specifies the date and time when the error occurred, and a detailed error message that specifies why the error occurred. This file is generated by the CPM built-in password generation plug-ins.  
- The name of the log file comprises the following details, which enable you to identify which account generated an error.

- Platform level debug log are stored here.  
- when a platform is being debugged (we have to do this in PVWA under the particular platform), this platform related messages are logged in the Third Party Logs Folder.

#### CPM Plugins

CPM plugins are used to connect PAM - Self-Hosted to target machines in order to manage passwords. CPM plugin functionality includes:

- Changing or verifying passwords on target machines
- Updating new passwords in the Vault
- Reconciling passwords, when necessary

## Troubleshooting Steps if CPM Fails to reconcile/change the Password

### CPM Login Flowchart

1. Attempt to log in with the password from the vault.
2. If the login fails, generate a new password.
3. Attempt to log in again with the new password.
4. If the second login is successful, update the vault with the new password.
5. If the update to the vault is successful, the process ends.
6. If the update to the vault fails, an error is shown.
7. If the second login attempt fails, a separate login error is shown.  
![mermaid.ink/svg/pako:eNp1kcFqwzAMhl_F6Jy-QA6Dtkl72UpZWA9LdhCxkhhiOyg2obR99znxyijrfDLyp08_1gVqKwlSaHo71R2yE6_vlRHhrMu1c6SHULGtMmJSrhMn9L0TRxzHybL8EqvVy3WHqr-KTbknQ4yOxIGmXyTKNjMpts-UT-jt4i18XdM4Nj7Ys_JjkLM7BvivMfvTmJf5IXt4jXF3ZdHZSfxYc2bLD8MjtY9UTHuHIAFNrFHJ8G-XuakC15GmCtJwbZElmQoqcwskemeLs6khdewpAb8MzBS2jBrSBvsxVEkqZ_ktrmLZSAIDmk9r78ztG8wrjps](https://mermaid.ink/svg/pako:eNp1kcFqwzAMhl_F6Jy-QA6Dtkl72UpZWA9LdhCxkhhiOyg2obR99znxyijrfDLyp08_1gVqKwlSaHo71R2yE6_vlRHhrMu1c6SHULGtMmJSrhMn9L0TRxzHybL8EqvVy3WHqr-KTbknQ4yOxIGmXyTKNjMpts-UT-jt4i18XdM4Nj7Ys_JjkLM7BvivMfvTmJf5IXt4jXF3ZdHZSfxYc2bLD8MjtY9UTHuHIAFNrFHJ8G-XuakC15GmCtJwbZElmQoqcwskemeLs6khdewpAb8MzBS2jBrSBvsxVEkqZ_ktrmLZSAIDmk9r78ztG8wrjps)  

### Troubleshooting: CPM Password Change/Reconciliation Failures

- Ping the IP address of the server of interest `ping {ip-address}` 
- Find the CPM that is handling this target server. 
- We have to check the CPM port connectivity with the target server, This kind of Issue is called _Flow Issue_ or _Communication issue_
- `Test-NetConnection` : By using `Test-NetConnection`, you can quickly diagnose network connectivity issues, ensuring that a host is reachable, a specific port is open, or even seeing the path your connection takes to reach its destination.
- Net use command can be used to login to the target-server : `net use \\{ip-address}\IPC$ /users:admin {Password}`, if this method works we can safely say that its not a password issue. 
- Target-Win Settings that need to be enabled/checked are mentioned in the table below this list
- Try to perform password change with another CPM ( other than the one that is creating the problem)
- Try to move the account to different platform and see if the same error persists.

It's used for inter-process communication, allowing the client to remotely communicate with the server.

## Settings for Troubleshooting

### Target-Windows Settings for CPM to Perform Password Change without Errors

| #  | Setting Category                              | Path & Setting                                                   | Configuration                                                                                     |
|----|------------------------------------------------|------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| 1  | User Rights Assignment                        | Local Security Settings > Local Policies > User Rights Assignment | "Access this computer from the network": Admin account added (part of the Administrator group).   |
| 2  | Local Account Sharing and Security Model      | Local Security Settings > Local Policies > Security Options      | "Network access: Sharing and security model for local accounts": Set to "Classic".                |
| 3  | User Account Control                          | N/A                                                              | "Run all administrators in Admin Approval Mode": Disabled.                                        |
| 4  | Admin Account Configuration                   | Local Users and Groups                                           | Admin account should NOT have the "user cannot change password" option enabled.                   |
| 5  | Group Membership                              | N/A                                                              | Ensure admin account is a member of the Administrator group.                                      |

### `Test-NetConnection`

 - `Test-NetConnection` : By using `Test-NetConnection`, you can quickly diagnose network connectivity issues, ensuring that a host is reachable, a specific port is open, or even seeing the path your connection takes to reach its destination.
	1. **Ping a Host**: `Test-NetConnection -ComputerName google.com`
	2. **Specify a Port**: `Test-NetConnection -ComputerName google.com -Port 80`
	3. **Information Only**: `Test-NetConnection -ComputerName google.com -InformationLevel Detailed`
	4. **Trace Route**: `Test-NetConnection -ComputerName google.com -TraceRoute`
	5. **Check Common Services**: `Test-NetConnection -ComputerName server_name -CommonTCPPort RDP` 
		1. _The cmdlet also includes predefined parameters for common services like `RDP` (Remote Desktop), `SMB` (Windows File Sharing), and more._

### `net use` Command

`net use \\{ip-address}\IPC$ /users:admin {Password}`
- `net use`: A command to connect, disconnect, or display computer connections to shared resources.
- `\\{ip-address}\IPC$`: This is specifying the IPC$ share on the remote machine with IP `{ip-address}`. The IPC$ share is a special share that allows for communication between processes and is used, for example, during remote administration tasks.
- `/users:admin`: This part specifies that the connection should be made using the "admin" username. It appears there's a typo in your provided command. It should be `/user:admin` (singular, not plural).
- `{Password}`: This represents the password for the "admin" user.

## CPM Ports

### Operating Systems and Ports

| Device                             | Protocol                                      | Port                                      |
|------------------------------------|-----------------------------------------------|-------------------------------------------|
| Windows Domain Accounts            | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 139, 445                                  |
|                                    | Kerberos                                      | 88                                        |
|                                    | DNS                                           | 53                                        |
| Windows Domain Accounts via LDAP   | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 139, 445                                  |
|                                    | LDAP/s                                        | 389, 636, 3268, 3269                      |
|                                    | Kerberos                                      | 88                                        |
|                                    | DNS                                           | 53                                        |
| Windows Desktop Accounts           | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 135, 445                                  |
| Windows Local Accounts             | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 139, 445                                  |
| Windows Local Accounts over WMI    | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 135, 445, dynamic port range              |
| Windows Services                   | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 135, 445, dynamic port range              |
| Windows Scheduled Tasks            | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 445, dynamic port range                   |
| Windows IIS Application Pools      | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 135, 445, dynamic port range              |
| COM+ Applications                  | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 135, 445, dynamic port range              |
| Windows IIS Directory Security     | Windows protocols (SMB, RPC, WMI, DCOM, etc.) | 135, 445, dynamic port range              |
| UNIX                               | SSH                                           | 22                                        |
|                                    | Telnet                                        | 23                                        |
| AS400                              | iSeries Access for Windows                    | 449, 8476                                 |
| OS/390                             | FTP                                           | 21                                        |
|                                    | SSH                                           | 22                                        |
|                                    | Telnet                                        | 23                                        |
| ESXi                               | HTTP                                          | 80                                        |
|                                    | HTTPS                                         | 443                                       |  

### Database Ports

|Device|Protocol|Port|
|---|---|---|
|ODBC|Can be changed, depending on the database|Can be changed, depending on the database|
|Oracle|Proprietary protocol|1521|
|MSSql|Proprietary protocol|1433|
|MySql|Proprietary protocol|3306|
|Sybase|Proprietary protocol|5000|
|DB2|Windows protocols (SMB, RPC, WMI, DCOM, etc.)|445|
|Unix SSH|22|
|Unix Telnet|23|
|Informix|Windows protocols (SMB, RPC, WMI, DCOM, etc.)|445|
|Unix SSH|22|
|Unix Telnet|23|
|Windows Registry|Windows protocols (SMB, RPC, WMI, DCOM, etc.)|135, 445, dynamic port range|
